(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"/K9E":function(e,t,a){"use strict";t["a"]=[{key:"/",title:"\u9996\u9875",icon:"home",isPublic:!0},{key:"commodity",title:"\u5546\u54c1",icon:"appstore",children:[{key:"/commodity/classify",title:"\u5546\u54c1\u7c7b\u578b",icon:"menu"},{key:"/commodity/manage",title:"\u5546\u54c1\u7ba1\u7406",icon:"edit"}]},{key:"graph",title:"\u56fe\u5f62\u56fe\u6807",icon:"area-chart",children:[{key:"/graph/pie",title:"\u67f1\u5f62\u56fe",icon:"pie-chart"},{key:"/graph/bar",title:"\u997c\u56fe",icon:"bar-chart"},{key:"/graph/line",title:"\u6298\u7ebf\u56fe",icon:"line-chart"}]},{key:"/role",title:"\u6743\u9650\u7ba1\u7406",icon:"safety-certificate"},{key:"/admin",title:"\u7528\u6237\u7ba1\u7406",icon:"user"}]},Iz7J:function(e,t,a){},Nlzp:function(e,t,a){"use strict";a("miYZ");var r=a("tsqr"),n=a("vDqi"),s=a.n(n);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET";return new Promise((n,o)=>{var i;i="GET"===a?s.a.get(e,{params:t}):s.a.post(e,t),i.then(e=>{n(e.data),console.log("\u8bf7\u6c42\u6210\u529f",e)}).catch(e=>{r["a"].error("\u8bf7\u6c42\u63a5\u53e3\u51fa\u9519\u4e86: "+e.message)})})}a.d(t,"i",function(){return c}),a.d(t,"f",function(){return l}),a.d(t,"a",function(){return u}),a.d(t,"m",function(){return d}),a.d(t,"e",function(){return m}),a.d(t,"j",function(){return h}),a.d(t,"o",function(){return p}),a.d(t,"l",function(){return g}),a.d(t,"g",function(){return f}),a.d(t,"b",function(){return y}),a.d(t,"k",function(){return S}),a.d(t,"d",function(){return k}),a.d(t,"n",function(){return w}),a.d(t,"p",function(){return v}),a.d(t,"h",function(){return E}),a.d(t,"c",function(){return b});var i="",c=(e,t)=>o(i+"/login",{username:e,password:t},"POST"),l=e=>o(i+"/manage/category/list",{parentId:e}),u=(e,t)=>o(i+"/manage/category/add",{categoryName:e,parentId:t},"POST"),d=e=>{var t=e.categoryId,a=e.categoryName;return o(i+"/manage/category/update",{categoryId:t,categoryName:a},"POST")},m=e=>o(i+"/manage/category/info",{categoryId:e}),h=(e,t)=>o(i+"/manage/product/list",{pageNum:e,pageSize:t}),p=(e,t)=>o(i+"/manage/product/updateStatus",{productId:e,status:t},"POST"),g=e=>{var t=e.pageNum,a=e.pageSize,r=e.searchName,n=e.searchType;return o(i+"/manage/product/search",{pageNum:t,pageSize:a,[n]:r})},f=e=>o(i+"/manage/img/delete",{name:e},"POST"),y=e=>o(i+"/manage/product/"+(e._id?"update":"add"),e,"POST"),S=()=>o(i+"/manage/role/list"),k=e=>o(i+"/manage/role/add",{roleName:e},"POST"),w=e=>o(i+"/manage/role/update",e,"POST"),v=()=>o(i+"/manage/user/list"),E=e=>o(i+"/manage/user/delete",{userId:e},"POST"),b=e=>o(i+"/manage/user/"+(e._id?"update":"add"),e,"POST")},PK5a:function(e,t,a){"use strict";a.r(t);var r=a("q1tI"),n=a.n(r),s=a("/MKj"),o=(a("IzEo"),a("bx4M")),i=(a("2qtc"),a("kLXV")),c=(a("g9YV"),a("wCAj")),l=a("jehZ"),u=a.n(l),d=(a("+L6B"),a("2/Rp")),m=(a("miYZ"),a("tsqr")),h=a("d6i3"),p=a.n(h),g=a("1l/V"),f=a.n(g),y=3,S=a("Nlzp"),k=(a("5NDa"),a("5rEg")),w=(a("y8nQ"),a("Vl3Y")),v=(a("17x9"),w["a"].Item),E=e=>{var t={labelCol:{span:4},wrapperCol:{span:20}},a=()=>{e.setForm(e.form)},s=e.form.getFieldDecorator;return Object(r["useEffect"])(()=>{a()},[]),n.a.createElement(w["a"],t,n.a.createElement(v,{label:"\u89d2\u8272\u540d\u79f0"},s("roleName",{rules:[{required:!0,message:"\u89d2\u8272\u540d\u79f0\u5fc5\u987b\u586b\u5199"}]})(n.a.createElement(k["a"],{placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"}))))},b=w["a"].create()(E),N=(a("ozfa"),a("MJZm")),C=a("/K9E"),I=w["a"].Item,P=N["a"].TreeNode;class O extends r["PureComponent"]{constructor(e){super(e),this.getMenus=(()=>this.state.checkedKeys),this.getTreeNodes=(e=>{return e.reduce((e,t)=>{return e.push(n.a.createElement(P,{title:t.title,key:t.key}," //* \u8fd9\u91cc\u7684key \u88ab\u6811\u7ec4\u4ef6\u7684CheckedKeys \u76d1\u542c",t.children?this.getTreeNodes(t.children):null)),e},[])}),this.onCheck=(e=>{this.setState({checkedKeys:e})});var t=this.props.role.menus;this.state={checkedKeys:t}}componentWillMount(){this.treeNodes=this.getTreeNodes(C["a"])}componentWillReceiveProps(e){console.log("componentWillReceiveProps()",e);var t=e.role.menus;this.setState({checkedKeys:t})}render(){var e=this.props.role,t=this.state.checkedKeys,a={labelCol:{span:6},wrapperCol:{span:18}};return n.a.createElement("div",null,n.a.createElement(I,u()({label:"\u89d2\u8272\u540d\u79f0"},a),n.a.createElement(k["a"],{value:e.name,disabled:!0})),n.a.createElement(N["a"],{checkable:!0,defaultExpandAll:!0,checkedKeys:t,onCheck:this.onCheck},n.a.createElement(P,{title:"\u5e73\u53f0\u6743\u9650",key:"all"},this.treeNodes)))}}var T={user:{},product:{}},x=a("khM/"),Y=(a("Iz7J"),a("Wgwc")),M=a.n(Y);class R extends r["PureComponent"]{constructor(e){var t;super(e),t=this,this.state={roles:[],role:{},isShowAdd:!1,isShowAuth:!1},this.initColumn=(()=>{this.columns=[{title:"\u89d2\u8272\u540d\u79f0",dataIndex:"name"},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",render:e=>M()(e).format("YYYY-MM-DD  HH:mm:ss")},{title:"\u6388\u6743\u65f6\u95f4",dataIndex:"auth_time",render:e=>M()(e).format("YYYY-MM-DD  HH:mm:ss")},{title:"\u6388\u6743\u4eba",dataIndex:"auth_name"}]}),this.getRoles=f()(p.a.mark(function e(){var a,r;return p.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(S["k"])();case 2:a=e.sent,0===a.status&&(r=a.data,t.setState({roles:r}));case 4:case"end":return e.stop()}},e)})),this.onRow=(e=>{return{onClick:t=>{this.setState({role:e})}}}),this.addRole=(()=>{this.form.validateFields(function(){var e=f()(p.a.mark(function e(a,r){var n,s,o;return p.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=8;break}return t.setState({isShowAdd:!1}),n=r.roleName,t.form.resetFields(),e.next=6,Object(S["d"])(n);case 6:s=e.sent,0===s.status?(m["a"].success("\u6dfb\u52a0\u89d2\u8272\u6210\u529f"),o=s.data,t.setState(e=>({roles:[...e.roles,o]}))):m["a"].success("\u6dfb\u52a0\u89d2\u8272\u5931\u8d25");case 8:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}())}),this.updateRole=f()(p.a.mark(function e(){var a,r,n;return p.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t.setState({isShowAuth:!1}),a=t.state.role,r=t.auth.current.getMenus(),a.menus=r,a.auth_time=M()().format("YYYY-MM-DD  HH:mm:ss"),a.auth_name=t.props.loginName,e.next=8,Object(S["n"])(a);case 8:n=e.sent,0===n.status&&(a._id===T.user.role_id?(T.user={},x["a"].removeUser(),t.props.history.replace("/login"),m["a"].success("\u5f53\u524d\u7528\u6237\u89d2\u8272\u6743\u9650\u6210\u529f")):(m["a"].success("\u8bbe\u7f6e\u89d2\u8272\u6743\u9650\u6210\u529f"),t.setState({roles:[...t.state.roles]})));case 10:case"end":return e.stop()}},e)})),this.auth=n.a.createRef()}componentWillMount(){this.initColumn()}componentDidMount(){this.getRoles()}render(){var e=this.state,t=e.roles,a=e.role,r=e.isShowAdd,s=e.isShowAuth,l={labelCol:{span:2},wrapperCol:{span:8}},m=n.a.createElement("span",null,n.a.createElement(d["a"],{type:"primary",onClick:()=>this.setState({isShowAdd:!0})},"\u521b\u5efa\u89d2\u8272")," \xa0\xa0",n.a.createElement(d["a"],{type:"primary",disabled:!a._id,onClick:()=>this.setState({isShowAuth:!0})},"\u8bbe\u7f6e\u89d2\u8272\u6743\u9650"));return n.a.createElement(o["a"],{title:m},n.a.createElement(c["a"],u()({},l,{bordered:!0,rowKey:"_id",dataSource:t,columns:this.columns,pagination:{defaultPageSize:y},rowSelection:{type:"radio",selectedRowKeys:[a._id],onSelect:e=>{this.setState({role:e})}},onRow:this.onRow})),n.a.createElement(i["a"],{title:"\u6dfb\u52a0\u89d2\u8272",visible:r,onOk:this.addRole,onCancel:()=>{this.setState({isShowAdd:!1}),this.form.resetFields()}},n.a.createElement(b,{setForm:e=>this.form=e})),n.a.createElement(i["a"],{title:"\u8bbe\u7f6e\u89d2\u8272\u6743\u9650",visible:s,onOk:this.updateRole,onCancel:()=>{this.setState({isShowAuth:!1})}},n.a.createElement(O,{ref:this.auth,role:a})))}}var K=Object(s["c"])(e=>({loginId:e.store.user._id,loginName:e.store.user.username}),null)(R);t["default"]=function(e){return n.a.createElement("div",null,n.a.createElement(K,null))}}}]);